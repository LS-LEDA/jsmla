function gradient(t,e){let n=100*e/t;return n<=25?"#C6DEFF":n<=50?"#82CAFF":n<=75?"#56A5EC":n<=100?"#1589FF":void 0}function getGradientColor(t,e,n){t=t.replace(/^\s*#|\s*$/g,""),e=e.replace(/^\s*#|\s*$/g,""),3==t.length&&(t=t.replace(/(.)/g,"$1$1")),3==e.length&&(e=e.replace(/(.)/g,"$1$1"));var i=parseInt(t.substr(0,2),16),s=parseInt(t.substr(2,2),16),a=parseInt(t.substr(4,2),16),l=parseInt(e.substr(0,2),16),d=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16),o=l-i,c=d-s,h=r-a;return o=(o*n+i).toString(16).split(".")[0],c=(c*n+s).toString(16).split(".")[0],h=(h*n+a).toString(16).split(".")[0],1==o.length&&(o="0"+o),1==c.length&&(c="0"+c),1==h.length&&(h="0"+h),"#"+o+c+h}function dateToYMD(t,e=""){var n=864e5*t,i=new Date;return i.setTime(i.getTime()-n),i.getFullYear()+e+(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+e+(i.getDate()<10?"0"+i.getDate():i.getDate())}function YMDToDate(t){let e=t.substr(4,2)-1;return new Date(t.substr(0,4),10>e?"0"+e:e,t.substr(6,2))}function changeInputFile(t){displayFileContents('<p id="loading-content">Loading content...</p><div class="loader"></div>'),dashb.msldb.readLogFromFile(t,rlffOnLoad,rlffOnProgress)}function fillDashboard(t){dashb.readFromFile(t,rlffDashbOnLoad)}function rlffDashbOnLoad(t){dashb.init(),renderDashboard(t.widgets)}function navigatorFilter(t,e,n){dashb.msldb.widgetFilter=dashb.msldb.widgetFilter||{},0==t&&(e=""),dashb.msldb.widgetFilter[n]=["BEGIN ("+e+")"],reRenderDashboard()}function reRenderDashboard(){if(0<dashb.widgets.length){let t=document.getElementById("loading-resources");document.getElementById("widgets").innerHTML="",document.getElementById("widgets").style.opacity=.5,t.style.display="block";let e=new Promise((t,e)=>{setTimeout(function(){t()},250)});e.then(()=>{renderDashboard(dashb.widgets)})}}function rlffOnLoad(t){let e=document.getElementById("file-log-label"),n=document.getElementById("drop-area"),i=document.getElementById("subheader"),s=document.getElementById("menu-bar"),a=document.getElementById("menu-left");i.style.display="flex",s.style.display="block",a.style.display="flex",n.style.display="none",e.innerHTML="Log: <b>"+t.fileName+"</b>",renderDefaultDashboard()}function rlffOnProgress(t){let e=Math.floor(Math.round(t.total/1024/1024)),n=Math.floor(Math.round(t.loaded/1024/1024));document.getElementById("loading-content").innerHTML="Loading content ("+n+" of "+e+")..."}function createWidgets(t){t.forEach(t=>{dashb.createWidget(t)})}function renderDashboard(t){if(0<dashb.widgets.length){let e=document.getElementById("loading-resources"),n=document.getElementById("loading-resources-msg"),i=document.getElementById("loading-resources-n"),s=document.getElementById("loading-resources-total");n.innerHTML="Loading charts resources",s.innerHTML=t.length,i.innerHTML="0",e.style.display="block",checkRender()}}function renderDefaultDashboard(){let t=[],e=[{html:'<div class="widget" style="flex-basis: 100%;">      <h1>Dashboard</h1>      </div>',mode:WIDGET_TEXT},{html:'<div class="widget section" style="flex-basis: 100%;">      <h2>1 Resum d\'interaccions en el curs</h2>      <p>Informació relativa al número d\'interaccions</p>      </div>',mode:WIDGET_TEXT},{height:200,size:.5,css:".widget .rowsOnly {font-weight:bold}",title:"Total",srcJS:"https://canvasjs.com/assets/script/canvasjs.min.js",srcCSS:"",mode:WIDGET_CODE_SNIPPET,snippet:'{let number = "%COUNT%"-0;document.getElementById("rows_%ID%").classList.add("rowsOnly");document.getElementById("rows_%ID%").innerHTML = number.toLocaleString();}',kpi:""},{height:200,size:.5,title:"Tasques",mode:WIDGET_CODE_SNIPPET,snippet:'{let number = "%COUNT%"-0;document.getElementById("rows_%ID%").innerHTML = number.toLocaleString();}',field:"event",filter:{description:["CONTAINS (assignment)"]}},{height:200,size:.5,title:"Fitxer",mode:WIDGET_CODE_SNIPPET,snippet:'{let number = "%COUNT%"-0;document.getElementById("rows_%ID%").innerHTML = number.toLocaleString();}',field:"event",filter:{component:["IN (Fitxer)"],description:["CONTAINS ('resource' activity)"]}},{height:200,size:.5,title:"Pàgines",mode:WIDGET_CODE_SNIPPET,snippet:'{let number = "%COUNT%"-0;document.getElementById("rows_%ID%").innerHTML = number.toLocaleString();}',field:"component",filter:{component:["BEGIN (Pà)"]}},{height:200,size:.5,title:"URL",mode:WIDGET_CODE_SNIPPET,snippet:'{let number = "%COUNT%"-0;document.getElementById("rows_%ID%").innerHTML = number.toLocaleString();}',field:"component",filter:{component:["IN (URL)"]}},{height:200,size:.5,title:"LTI",mode:WIDGET_CODE_SNIPPET,snippet:'{let number = "%COUNT%"-0;document.getElementById("rows_%ID%").innerHTML = number.toLocaleString();}',field:"component",filter:{component:["CONTAINS (lti)"]}},{height:200,size:.5,title:"Wiki",mode:WIDGET_CODE_SNIPPET,snippet:'{let number = "%COUNT%"-0;document.getElementById("rows_%ID%").innerHTML = number.toLocaleString();}',field:"component",filter:{component:["CONTAINS (Wiki)"]}},{html:'<div style="flex-basis: 100%;"></div>',mode:WIDGET_TEXT},{visible:!1,mode:WIDGET_CODE_SNIPPET,snippet:"[%LABELS%,%VALUES%]",field:"yearMonthDay",sortBy:"key",filter:{component:["BEGIN (Pà)"]}},{visible:!1,mode:WIDGET_CODE_SNIPPET,snippet:"[%LABELS%,%VALUES%]",field:"yearMonthDay",sortBy:"key",filter:{component:["IN (URL)"]}},{width:"1000",height:"300",title:"Timeline d'interaccions",mode:WIDGET_CODE_SNIPPET,snippet:'      let labels = %LABELS%;      let values = %VALUES%;      let dataPoints = new Array();      for (let i = 0; i < labels[0].length; i++){        dataPoints.push({x:new Date(labels[0][i].substr(0,4), labels[0][i].substr(4,2)-1, labels[0][i].substr(6,2)),y:values[0][i]});      };      let dataPoints2 = new Array();      for (let i = 0; i < labels[1].length; i++){        dataPoints2.push({x:new Date(labels[1][i].substr(0,4), labels[1][i].substr(4,2)-1, labels[1][i].substr(6,2)),y:values[1][i]});      };      let dataPoints3 = new Array();      for (let i = 0; i < labels[2].length; i++){        dataPoints3.push({x:new Date(labels[2][i].substr(0,4), labels[2][i].substr(4,2)-1, labels[2][i].substr(6,2)),y:values[2][i]});      };      let dataPoints4 = new Array();      for (let i = 0; i < labels[3].length; i++){        dataPoints4.push({x:new Date(labels[3][i].substr(0,4), labels[3][i].substr(4,2)-1, labels[3][i].substr(6,2)),y:values[3][i]});      };      let dataPoints5 = new Array();      for (let i = 0; i < labels[4].length; i++){        dataPoints5.push({x:new Date(labels[4][i].substr(0,4), labels[4][i].substr(4,2)-1, labels[4][i].substr(6,2)),y:values[4][i]});      };      document.getElementById("content_%ID%").style.height = (%HEIGHT%-70)+"px";      var chart = new CanvasJS.Chart("content_%ID%", {        height:%HEIGHT%-70        ,animationEnabled: true,        title:{          text: ""        },        toolTip: {          shared: true        },        legend: {          cursor: "pointer",          verticalAlign: "top",          itemWidth:150        },        data: [          {            type: "line",            name: "Total",            showInLegend: true,            dataPoints: dataPoints          },          {            type: "line",            name: "Tasca",            showInLegend: true,            dataPoints: dataPoints2          },          {            type: "line",            name: "Fitxer",            showInLegend: true,            dataPoints: dataPoints3          },          {            type: "line",            name: "Pàgina",            showInLegend: true,            dataPoints: dataPoints4          },          {            type: "line",            name: "URL",            showInLegend: true,            dataPoints: dataPoints5          }        ]      });      chart.render();',field:"yearMonthDay",sortBy:"key",filter:[{},{description:["CONTAINS (assignment)"]},{component:["IN (Fitxer)"],description:["CONTAINS ('resource' activity)"]},{component:["BEGIN (Pà)"]},{component:["IN (URL)"]}]},{width:"1000",height:"500",title:"Interaccions dies i franja horària",mode:WIDGET_CODE_SNIPPET,snippet:'{            let widget = document.getElementById("content_%ID%");            let labels = %LABELS%;            let values = %VALUES%;            let height = %HEIGHT% - 100;            let diesHores = {};            let maxVal = 0;            for (let i = 0; i < labels.length; i++){              let wDate = new Date(labels[i]*1000);              if (undefined === diesHores[wDate.getDay()])                diesHores[wDate.getDay()] = {};              if (undefined === diesHores[wDate.getDay()][wDate.getHours()])                diesHores[wDate.getDay()][wDate.getHours()] = 0;              diesHores[wDate.getDay()][wDate.getHours()] += values[i];              if (diesHores[wDate.getDay()][wDate.getHours()] > maxVal)                maxVal = diesHores[wDate.getDay()][wDate.getHours()];            }            diesHores[7] = diesHores[0];            let str = "<table>                <thead>                    <tr>                        <th class=\\"tdLeft\\" style=\\"width:100px\\">Franja</th>                        <th class=\\"tdCenter\\" style=\\"width:100px\\">Dilluns</th>                        <th class=\\"tdCenter\\" style=\\"width:100px\\">Dimarts</th>                        <th class=\\"tdCenter\\" style=\\"width:100px\\">Dimecres</th>                        <th class=\\"tdCenter\\" style=\\"width:100px\\">Dijous</th>                        <th class=\\"tdCenter\\" style=\\"width:100px\\">Divendres</th>                        <th class=\\"tdCenter\\" style=\\"width:100px\\">Dissabte</th>                        <th class=\\"tdCenter\\" style=\\"width:100px\\">Diumenge</th>                    </tr>                </thead>                <tbody style=\'max-height:"+height+"px\'>";                for (let i = 0; i <24; i++) {                  str += "<tr>";                  str += "<td class=\\"tdLeft\\" style=\\"width:100px\\">" + i + ":00-"+i+":59</td>";                  for (let j = 1; j <= 7; j++) {                    diesHores[j] = diesHores[j] || {};                    let val = ((undefined !== diesHores[j][i])?diesHores[j][i]:0);                    str += "<td class=\\"tdCenter\\" style=\\"background:"+gradient(maxVal,val)+";width:100px\\">" + val.toLocaleString() + "</td>";                  }                  str += "</tr>";                }                str += "</tbody>                </table>";              widget.insertAdjacentHTML("afterbegin", str);          }',field:"timestamp"},{html:'<div class="widget section" style="flex-basis: 100%;">      <h2>2 Estudiants</h2>      <p>Informació relativa a les interaccions dels estudiants</p>      </div>',mode:WIDGET_TEXT},{width:"1000",height:"300",title:"Últim accés i estudiant",srcJS:"https://canvasjs.com/assets/script/canvasjs.min.js",srcCSS:"",mode:WIDGET_CODE_SNIPPET,snippet:'      let labels = %LABELS%;      let values = %VALUES%;      let lvGroup = {};      let lvGroupStudent = {};      let dataPoints = new Array();      let maxDays = 0;      for (let i = 0; i < labels.length; i++){        let diff = new Date().diffTimestamp(values[i]);        lvGroup[diff.days] = ((undefined!==lvGroup[diff.days])?lvGroup[diff.days]:0) + 1;        if (undefined===lvGroupStudent[diff.days])        {          lvGroupStudent[diff.days] = new Array();        }        lvGroupStudent[diff.days][lvGroupStudent[diff.days].length] = labels[i];        maxDays = (diff.days > maxDays)?diff.days:maxDays;      };      for (let prop in lvGroup){        dataPoints.push({x:prop,y:lvGroup[prop]});      };      document.getElementById("content_%ID%").style.height = (%HEIGHT%-70)+"px";      var chart = new CanvasJS.Chart("content_%ID%", {        height:%HEIGHT%-70        ,animationEnabled: true,        title:{          text: ""        },        toolTip: {          contentFormatter: function ( e ) {                      return "Fa " +  e.entries[0].dataPoint.x + " dies accediren " + e.entries[0].dataPoint.y + " estudiants<br/>" + lvGroupStudent[e.entries[0].dataPoint.x].join("<br/>");            },          shared: true        },        legend: {          cursor: "pointer",          verticalAlign: "top",          itemWidth:150        },        axisX:{          interval: 5,          maximum: maxDays+1,          includeZero: true        },        data: [          {            type: "line",            name: "Estudiants",            showInLegend: true,            dataPoints: dataPoints          },        ]      });      chart.render();',field:"fullName",calcFn:{fn:"lastconnection",field:"timestamp"}},{width:"1000",height:"500",title:"Mapa calor Accesos Recursos - Estudiant",mode:WIDGET_CODE_SNIPPET,snippet:'{        let widget = document.getElementById("content_%ID%");        let labels = %LABELS%;        let values = %VALUES%;        let height = %HEIGHT% - 100;        let axisX = new Array();        for (let i = 0; i < labels.length; i++) {          for (let prop in values[i]){            axisX[prop] = 0;          }        }        let str = "<table style=\\"min-width:150px\\">            <thead>                <tr>                    <th style=\\"min-width:150px;max-width:150px;white-space: nowrap\\" class=\\"tdLeft\\">Recurs</th>";                    for (let prop in axisX){                      str += "<th title=\\"" + prop + "\\" style=\\"min-width:40px;max-width:40px;overflow: hidden;text-overflow: ellipsis;width:150px;white-space: nowrap\\" class=\\"tdCenter\\">" + prop + "</th>";                    };        str += "</tr>            </thead>            <tbody style=\'max-height:"+height+"px\'>";        let maxVal = 0;        for (let i = 0; i < labels.length; i++) {          for (let prop in axisX){            let val = ((undefined!==values[i][prop])?values[i][prop]:0);            if (val > maxVal)              maxVal = val;          };        };        for (let i = 0; i < labels.length; i++) {            str += "<tr>";            str += "<td title=\\"" + labels[i].replace(\'"\',\'"\') + "\\" style=\\"min-width:150px;max-width:150px;overflow: hidden;text-overflow: ellipsis;width:150px;white-space: nowrap\\" class=\\"tdLeft\\">" + labels[i] + "</td>";            for (let prop in axisX){              let val = ((undefined!==values[i][prop])?values[i][prop]:0);              str += "<td style=\\"min-width:40px;width:40px;white-space: nowrap;background:"+gradient(maxVal,val)+"\\" class=\\"tdRight\\">" + val.toLocaleString() + "</td>";            };            str += "</tr>"; };        str += "</tbody>            </table>";        widget.insertAdjacentHTML("afterbegin", str);      }',sortBy:"key",order:"ASC",field:"context",calcFn:{fn:"countgroup",field:"fullName"},filter:{fullName:["NOT BEGIN (undefined)"]}},{width:"475",height:"500",title:"Participació",mode:WIDGET_CODE_SNIPPET,snippet:'{        let interactions = dashb.widgets[2].data.values[0];        let widget = document.getElementById("content_%ID%");        let labels = %LABELS%;        let values = %VALUES%;        let height = %HEIGHT% - 100;        let str = "<table>            <thead>                <tr>                    <th  class=\\"tdLeft\\">Estudiant</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">%</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">#</th>                </tr>            </thead>            <tbody style=\'max-height:"+height+"px\'>";        for (let i = 0; i < labels.length; i++) {            let percent = (values[i]*100)/interactions;            str += "<tr>";            str += "<td class=\\"tdLeft\\">" + labels[i] + "</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdCenter " + ((10<percent)?"tdGreenLight":((5<percent)?"tdOrangeLight":"tdRedLight")) + "\\">" + (Math.round(percent*100)/100).toLocaleString() + "%</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdRight\\">" + values[i] + "</td>";            str += "</tr>"; };        str += "</tbody>            </table>";        widget.insertAdjacentHTML("afterbegin", str);      }',sortBy:"key",order:"ASC",field:"fullName"},{width:"475",height:"500",title:"Últim accés",mode:WIDGET_CODE_SNIPPET,snippet:'{        let interactions = dashb.widgets[2].data.values[0];        let widget = document.getElementById("content_%ID%");        let labels = %LABELS%;        let values = %VALUES%;        let height = %HEIGHT% - 100;        let str = "<table>            <thead>                <tr>                    <th class=\\"tdLeft\\">Estudiant</th>                    <th style=\\"width:160px;\\" class=\\"tdCenter\\">Últim accés</th>                </tr>            </thead>            <tbody style=\'max-height:"+height+"px\'>";        for (let i = 0; i < labels.length; i++) {          if (labels[0].length){            let wDate = new Date(values[i]*1000).toLocaleString();            let percent = (values[i]*100)/interactions;            let wDateDiff = new Date().diffTimestamp(values[i]);            let wDateStr = wDateDiff.days+" dies "+wDateDiff.hours+" hores <br />"+wDateDiff.minutes+" minuts, "+Math.floor(wDateDiff.seconds)+" segons";            str += "<tr>";            str += "<td class=\\"tdLeft\\">" + labels[i] + "</td>";            str += "<td style=\\"width:160px;\\" class=\\"tdCenter " + ((1>wDateDiff.days)?"tdGreenLight":((3>wDateDiff.days)?"tdOrangeLight":"tdRedLight")) + "\\">" + wDate + "<br/><b>" + wDateStr + "</b></td>";            str += "</tr>"; };          }          str += "</tbody>            </table>";          widget.insertAdjacentHTML("afterbegin", str);        }',field:"fullName",calcFn:{fn:"lastconnection",field:"timestamp"}},{html:'<div class="widget section" style="flex-basis: 100%;">      <h2>3 Recursos</h2>      <p>Informació relativa a interaccions amb recursos</p>      </div>',mode:WIDGET_TEXT},{width:"475",height:"500",title:"Última interacció recursos",mode:WIDGET_CODE_SNIPPET,snippet:'{        let interactions = dashb.widgets[2].data.values[0];        let widget = document.getElementById("content_%ID%");        let labels = %LABELS%;        let values = %VALUES%;        let height = %HEIGHT% - 100;        let str = "<table>            <thead>                <tr>                    <th class=\\"tdLeft\\">Recurs</th>                    <th style=\\"width:160px;\\" class=\\"tdCenter\\">Últim accés</th>                </tr>            </thead>            <tbody style=\'max-height:"+height+"px\'>";        for (let i = 0; i < labels.length; i++) {          if (labels[0].length){            let wDate = new Date(values[i]*1000).toLocaleString();            let percent = (values[i]*100)/interactions;            let wDateDiff = new Date().diffTimestamp(values[i]);            let wDateStr = wDateDiff.days+" dies "+wDateDiff.hours+" hores <br />"+wDateDiff.minutes+" minuts, "+Math.floor(wDateDiff.seconds)+" segons";            str += "<tr>";            str += "<td class=\\"tdLeft\\">" + labels[i] + "</td>";            str += "<td style=\\"width:160px;\\" class=\\"tdCenter " + ((1>wDateDiff.days)?"tdGreenLight":((3>wDateDiff.days)?"tdOrangeLight":"tdRedLight")) + "\\">" + wDate + "<br/><b>" + wDateStr + "</b></td>";            str += "</tr>"; };          }          str += "</tbody>            </table>";          widget.insertAdjacentHTML("afterbegin", str);        }',field:"context",calcFn:{fn:"lastconnection",field:"timestamp"}},{width:"475",height:"500",title:"Interaccions amb recursos",mode:WIDGET_CODE_SNIPPET,snippet:'{        let interactions = dashb.widgets[2].data.values[0];        let widget = document.getElementById("content_%ID%");        let labels = %LABELS%;        let values = %VALUES%;        let height = %HEIGHT% - 100;        let str = "<table>            <thead>                <tr>                    <th  class=\\"tdLeft\\">Recurs</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">%</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">#</th>                </tr>            </thead>            <tbody style=\'max-height:"+height+"px\'>";        for (let i = 0; i < labels.length; i++) {            let percent = (values[i]*100)/interactions;            str += "<tr>";            str += "<td class=\\"tdLeft\\">" + labels[i] + "</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdCenter " + ((10<percent)?"tdGreenLight":((5<percent)?"tdOrangeLight":"tdRedLight")) + "\\">" + (Math.round(percent*100)/100).toLocaleString() + "%</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdRight\\">" + values[i] + "</td>";            str += "</tr>"; };        str += "</tbody>            </table>";        widget.insertAdjacentHTML("afterbegin", str);      }',sortBy:"key",order:"ASC",field:"context"},{width:"475",height:"500",title:"Interaccions amb components",mode:WIDGET_CODE_SNIPPET,snippet:'{        let interactions = dashb.widgets[2].data.values[0];        let widget = document.getElementById("content_%ID%");        let labels = %LABELS%;        let values = %VALUES%;        let height = %HEIGHT% - 100;        let str = "<table>            <thead>                <tr>                    <th  class=\\"tdLeft\\">Component</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">%</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">#</th>                </tr>            </thead>            <tbody style=\'max-height:"+height+"px\'>";        for (let i = 0; i < labels.length; i++) {            let percent = (values[i]*100)/interactions;            str += "<tr>";            str += "<td class=\\"tdLeft\\">" + labels[i] + "</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdCenter " + ((10<percent)?"tdGreenLight":((5<percent)?"tdOrangeLight":"tdRedLight")) + "\\">" + (Math.round(percent*100)/100).toLocaleString() + "%</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdRight\\">" + values[i] + "</td>";            str += "</tr>"; };        str += "</tbody>            </table>";        widget.insertAdjacentHTML("afterbegin", str);      }',sortBy:"key",order:"ASC",field:"component"},{width:"475",height:"500",title:"Interaccions amb esdeveniments",mode:WIDGET_CODE_SNIPPET,snippet:'{        let interactions = dashb.widgets[2].data.values[0];        let widget = document.getElementById("content_%ID%");        let labels = %LABELS%;        let values = %VALUES%;        let height = %HEIGHT% - 100;        let str = "<table>            <thead>                <tr>                    <th  class=\\"tdLeft\\">Esdeveniment</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">%</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">#</th>                </tr>            </thead>            <tbody style=\'max-height:"+height+"px\'>";        for (let i = 0; i < labels.length; i++) {            let percent = (values[i]*100)/interactions;            str += "<tr>";            str += "<td class=\\"tdLeft\\">" + labels[i] + "</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdCenter " + ((10<percent)?"tdGreenLight":((5<percent)?"tdOrangeLight":"tdRedLight")) + "\\">" + (Math.round(percent*100)/100).toLocaleString() + "%</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdRight\\">" + values[i] + "</td>";            str += "</tr>"; };        str += "</tbody>            </table>";        widget.insertAdjacentHTML("afterbegin", str);      }',sortBy:"key",order:"ASC",field:"event"},{width:"475",height:"500",title:"Interaccions amb context",mode:WIDGET_CODE_SNIPPET,snippet:'{        let interactions = dashb.widgets[2].data.values[0];        let widget = document.getElementById("content_%ID%");        let labels = %LABELS%;        let values = %VALUES%;        let height = %HEIGHT% - 100;        let str = "<table>            <thead>                <tr>                    <th  class=\\"tdLeft\\">Context</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">%</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">#</th>                </tr>            </thead>            <tbody style=\'max-height:"+height+"px\'>";        for (let i = 0; i < labels.length; i++) {            let percent = (values[i]*100)/interactions;            str += "<tr>";            str += "<td class=\\"tdLeft\\">" + labels[i] + "</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdCenter " + ((10<percent)?"tdGreenLight":((5<percent)?"tdOrangeLight":"tdRedLight")) + "\\">" + (Math.round(percent*100)/100).toLocaleString() + "%</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdRight\\">" + values[i] + "</td>";            str += "</tr>"; };        str += "</tbody>            </table>";        widget.insertAdjacentHTML("afterbegin", str);      }',sortBy:"key",order:"ASC",field:"context",filter:{context:["NOT BEGIN (Curs:)"]}},{width:"475",height:"500",title:"Interaccions amb URL",mode:WIDGET_CODE_SNIPPET,snippet:'{        let interactions = dashb.widgets[2].data.values[0];        let widget = document.getElementById("content_%ID%");        let labels = %LABELS%;        let values = %VALUES%;        let height = %HEIGHT% - 100;        let str = "<table>            <thead>                <tr>                    <th  class=\\"tdLeft\\">URL</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">%</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">#</th>                </tr>            </thead>            <tbody style=\'max-height:"+height+"px\'>";        for (let i = 0; i < labels.length; i++) {            let percent = (values[i]*100)/interactions;            str += "<tr>";            str += "<td class=\\"tdLeft\\">" + labels[i] + "</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdCenter " + ((10<percent)?"tdGreenLight":((5<percent)?"tdOrangeLight":"tdRedLight")) + "\\">" + (Math.round(percent*100)/100).toLocaleString() + "%</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdRight\\">" + values[i] + "</td>";            str += "</tr>"; };        str += "</tbody>            </table>";        widget.insertAdjacentHTML("afterbegin", str);      }',sortBy:"key",order:"ASC",field:"context",filter:{component:["IN (URL)"]}},{width:"475",height:"500",title:"Interaccions amb Pàgines",mode:WIDGET_CODE_SNIPPET,snippet:'{        let interactions = dashb.widgets[2].data.values[0];        let widget = document.getElementById("content_%ID%");        let labels = %LABELS%;        let values = %VALUES%;        let height = %HEIGHT% - 100;        let str = "<table>            <thead>                <tr>                    <th  class=\\"tdLeft\\">Pàgina</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">%</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">#</th>                </tr>            </thead>            <tbody style=\'max-height:"+height+"px\'>";        for (let i = 0; i < labels.length; i++) {            let percent = (values[i]*100)/interactions;            str += "<tr>";            str += "<td class=\\"tdLeft\\">" + labels[i] + "</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdCenter " + ((10<percent)?"tdGreenLight":((5<percent)?"tdOrangeLight":"tdRedLight")) + "\\">" + (Math.round(percent*100)/100).toLocaleString() + "%</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdRight\\">" + values[i] + "</td>";            str += "</tr>"; };        str += "</tbody>            </table>";        widget.insertAdjacentHTML("afterbegin", str);      }',sortBy:"key",order:"ASC",field:"context",filter:{component:["IN (Pàgina)"]}},{width:"475",height:"500",title:"Interaccions amb Eina ext LTI",mode:WIDGET_CODE_SNIPPET,snippet:'{        let interactions = dashb.widgets[2].data.values[0];        let widget = document.getElementById("content_%ID%");        let labels = %LABELS%;        let values = %VALUES%;        let height = %HEIGHT% - 100;        let str = "<table>            <thead>                <tr>                    <th  class=\\"tdLeft\\">Eina ext LTI</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">%</th>                    <th style=\\"width:50px;\\" class=\\"tdCenter\\">#</th>                </tr>            </thead>            <tbody style=\'max-height:"+height+"px\'>";        for (let i = 0; i < labels.length; i++) {            let percent = (values[i]*100)/interactions;            str += "<tr>";            str += "<td class=\\"tdLeft\\">" + labels[i] + "</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdCenter " + ((10<percent)?"tdGreenLight":((5<percent)?"tdOrangeLight":"tdRedLight")) + "\\">" + (Math.round(percent*100)/100).toLocaleString() + "%</td>";            str += "<td style=\\"width:50px;\\" class=\\"tdRight\\">" + values[i] + "</td>";            str += "</tr>"; };        str += "</tbody>            </table>";        widget.insertAdjacentHTML("afterbegin", str);      }',sortBy:"key",order:"ASC",field:"context",filter:{component:["IN (Eina ext LTI)"]}},{width:"1000",height:"300",title:"Components",srcJS:"https://cdn.jsdelivr.net/npm/chart.js@2.8.0",srcCSS:"",mode:WIDGET_CODE_SNIPPET,snippet:"var canvas = document.createElement('canvas');            canvas.id = 'canvas_%ID%';            canvas.width = '%WIDTH%';            canvas.style.width = '%WIDTH%';canvas.height = '%HEIGHT%'-70;canvas.style.height = '%HEIGHT%'-70;document.getElementById('content_%ID%').appendChild(canvas);new Chart(document.getElementById('canvas_%ID%').getContext('2d'), {type: 'pie',options:{tooltips: {bodyFontColor:'#000000',bodyFontSize:14,bodyFontStyle:'bold',caretSize:0,xPadding:0,yPadding:0},responsive: false,maintainAspectRatio:false,legend:{position:'left'}},data: {labels: %LABELS%,datasets: [{data: %VALUES%,backgroundColor:['rgb(255, 99, 132)','rgb(54, 162, 235)','rgb(255, 205, 86)','rgb(255, 0, 0)','rgb(0, 255, 0)','rgb(0, 0, 255)']}]}});",field:"component"}];t=t.concat(e),createWidgets(t),renderDashboard(t)}function checkRender(){let t=!1,e=0,n=document.getElementById("loading-resources-n");if(dashb.widgets.forEach(n=>{WIDGET_JS_CSS_LOADING===n.loaded||WIDGET_JS_LOADED!==(n.loaded&WIDGET_JS_LOADED)||WIDGET_CSS_LOADED!==(n.loaded&WIDGET_CSS_LOADED)?t=!0:e++}),n.innerHTML=e,t)setTimeout(checkRender,500);else{let t=document.getElementById("loading-resources-msg"),e=document.getElementById("loading-resources-total");t.innerHTML="Rendering charts",e.innerHTML=dashb.widgets.length,n.innerHTML="0";let i=new Promise((t,e)=>{setTimeout(function(){t()},250)});i.then(()=>{render()})}}function render(){let t=document.getElementById("loading-resources-n"),e=document.getElementById("loading-resources-total"),n=document.getElementById("loading-resources");dashb.widgets.forEach(i=>{new Promise((t,e)=>{setTimeout(function(){t()},250)}).then(()=>{dashb.renderWidget(i,renderJSWidget,renderTextWidget),t.innerHTML=parseInt(t.innerHTML)+1,e.innerHTML==t.innerHTML&&(n.style.display="none",navigatorInit("Show all students","fullName"),navigatorInit("Show all resources","context"),document.getElementById("widgets").style.opacity=1)})})}function navigatorInit(t,e){if(null==document.getElementById("nav_"+e)){let n={},i=[],s=document.getElementById("menu-navigator");dashb.msldb.logs.forEach(t=>{n[t[e]]=0});for(let t in n)i.push(t);i.sort();let a='    <form id="nav_'+e+'" onsubmit="return false;">    <button class="btn small" onclick="let sel = this.form.elements[1]; if (sel.selectedIndex>0) {sel.selectedIndex-=1;sel.onchange();}"><i class="fas fa-chevron-left"></i></button>    <select style="max-width:250px" onchange="navigatorFilter(this.selectedIndex,this.options[this.selectedIndex].text,\''+e+"');\">";a+="<option>"+t+"</option>",i.forEach(t=>{a+="<option>"+t+"</option>"}),a+='</select><button class="btn small" onclick="let sel = this.form.elements[1]; if (sel.selectedIndex<sel.options.length-1) {sel.selectedIndex+=1;sel.onchange();}"><i class="fas fa-chevron-right"></i></button>    </form>',s.insertAdjacentHTML("beforeend",a)}}
function renderJSWidget(t){t.visible&&document.getElementById("widgets").insertAdjacentHTML("beforeend",t.evaluatedCSSHTML),t.evalAndExecuteSnippet()}function editJSWidget(t){t.visible&&(document.getElementById(t.id).outerHTML=t.evaluatedCSSHTML),t.evalAndExecuteSnippet()}function renderTextWidget(t){t.visible&&document.getElementById("widgets").insertAdjacentHTML("beforeend",t.evaluatedCSSHTML)}function displayFileContents(t,e=!0){var n=document.getElementById("file-content");n.style.display=e?"block":"none",void 0!==t&&(n.innerHTML=t)}function globalFilter(){let t=[];for(let e in dashb.msldb.logs[0])t[t.length]=e;let e=["IN","CONTAINS","BEGIN WITH","END WITH","BETWEEN","BETWEENEQ","EQUAL TO","NOTEQUAL TO","LESS THAN","LESSEQ TAHN","GREATER THAN","GREATEREQ THAN"],n=["string","number","date"];dashb.modal.headerContent='<i class="fas fa-filter"></i>Global filter',dashb.modal.content='    <form onsubmit="return false;">      <!--<div>        <input type="checkbox" >        <label for="meeting-time" style="display:inline-block;width:200px">From date & time:</label>        <input type="datetime-local" id="meeting-time"           name="meeting-time" value="2018-06-12T19:30"></input>      </div>      <div>        <input type="checkbox" >        <label for="meeting-time" style="display:inline-block;width:200px">To date & time:</label>        <input type="datetime-local" id="meeting-time"           name="meeting-time" value="2018-06-12T19:30"></input>      </div>-->      <div>        <select>'+t.map(t=>{return"<option>"+t+"</option>"})+"</select>        &nbsp;        <select>"+e.map(t=>{return"<option>"+t+"</option>"})+"</select>        &nbsp;        <select>"+n.map(t=>{return"<option>"+t+"</option>"})+'</select>      </div>      <div>        <button onclick="updateGlobalFilter(this.form);">Update global filter</button>      </div>    </form>',dashb.modal.show()}function newWidget(){let t=[];for(let e in dashb.msldb.logs[0])t[t.length]=e;dashb.modal.headerContent='<i class="fas fa-plus"></i>New widget',dashb.modal.content='  <form onsubmit="return false;">    <div>      <select>'+t.map(t=>{return"<option>"+t+"</option>"})+'</select>    </div>    <div>      <button onclick="updateGlobalFilter(this.form);">Add chart</button>    </div>  </form>',dashb.modal.show()}function dateFilter(){let t=getDateFilter();dashb.modal.headerContent='<i class="fas fa-calendar-alt"></i>&nbsp;Date filter',dashb.modal.content='  <form onsubmit="return false;">    <div>      <label for="dateWidgetFrom" style="display:inline-block;width:200px">From date:</label>      <input type="date" id="dateWidgetFrom"        name="dateWidgetFrom" value="'+t[0]+'"></input>    </div>    <div>&nbsp;</div>    <div>      <label for="dateWidgetTo" style="display:inline-block;width:200px">To date:</label>      <input type="date" id="dateWidgetTo"        name="dateWidgetTo" value="'+t[1]+'"></input>    </div>    <div>&nbsp;</div>    <div>      <button class="btn" onclick="updateDateFilter(this.form.dateWidgetFrom.value, this.form.dateWidgetTo.value);">Update dates</button>    </div>  </form>',dashb.modal.show()}function editWidget(t){let e=dashb.getWidgetById(t);dashb.modal.headerContent=e.title,dashb.modal.content='    <form onsubmit="return false;">      <p>Title</p>      <div>        <input name="title" type="text" value="'+e._title+'">      </div>      <p>Size</p>      <div>        <input name="size" type="number" value="'+e._size+'">      </div>      <p>Template</p>      <div id="editor-template" class="codemirror-editor">        <textarea name="codeditor-template" id="codeditor-template" style="display: none;">'+e._html+'</textarea>      </div>      <p>JavaScript Snippet</p>      <div id="editor-js" class="codemirror-editor">        <textarea name="codeditor-js" id="codeditor-js" style="display: none;">'+e._snippet+"</textarea>      </div>      <div>        <button onclick=\"updateWidget('"+t+"', this.form);\">Update widget</button>        <button onclick=\"deleteWidget('"+t+"');\">Delete widget</button>      </div>    </form>",dashb.modal.show();CodeMirror.fromTextArea(document.getElementById("codeditor-template"),{lineNumbers:!0,mode:"htmlmixed"}),CodeMirror.fromTextArea(document.getElementById("codeditor-js"),{lineNumbers:!0,mode:"htmlmixed"})}function deleteWidget(t){let e=dashb.getWidgetById(t);dashb.widgets.splice(e._index,1),document.getElementById(e.id).outerHTML="",dashb.modal.close()}function updateWidget(t,e){let n=dashb.getWidgetById(t);n._size=e.elements.size.value,n._title=e.elements.title.value,n._html=e.elements["codeditor-template"].value,n._snippet=e.elements["codeditor-js"].value,dashb.modal.close(),dashb.renderWidget(n,editJSWidget,function(){})}function schema(t){"/"===t[0].substr(1,1)&&(t[0]="0"+t[0]);let e={fullDate:t[0],yearMonthDay:t[0].substr(6,4)+""+t[0].substr(3,2)+t[0].substr(0,2),yearMonthDayHourMinute:t[0].substr(6,4)+""+t[0].substr(3,2)+t[0].substr(0,2)+t[0].substr(11,2)+t[0].substr(14,2),timestamp:Date.parse(t[0].substr(6,4)+"-"+t[0].substr(3,2)+"-"+t[0].substr(0,2)+"T"+t[0].substr(11,2)+":"+t[0].substr(14,2)+":00")/1e3,user:t[1],name:t[1].split(" ")[0],middleName:t[1].split(" ")[t[1].split(" ").length-2],lastName:t[1].split(" ")[t[1].split(" ").length-1],affectedUser:t[2],context:t[3],component:t[4],event:t[5],description:t[6],origin:t[7],ip:t[8]};return e.fullName=e.middleName+" "+e.lastName+", "+e.name,e.fullNameDePersonalized=e.fullName.dePersonalize(),e}function filters(){return{IN:{regex:/^IN [(](.*)[)]/gm,fn:(t,e)=>{return t.toLowerCase()==e.toLowerCase()}},CONTAINS:{regex:/CONTAINS [(](.*)[)]/gm,fn:(t,e)=>{return-1<t.toLowerCase().indexOf(e.toLowerCase())}},BEGIN:{regex:/BEGIN [(](.*)[)]/gm,fn:(t,e)=>{return 0==t.toLowerCase().indexOf(e.toLowerCase())}},END:{regex:/END [(](.*)[)]/gm,fn:(t,e)=>{return t.length-e.length==t.toLowerCase().indexOf(e.toLowerCase())}},BETWEEN:{regex:/BETWEEN [(](.*)[)]/gm,fn:(t,e,n)=>{return t>e&&t<n}},BETWEENEQ:{regex:/BETWEENEQ [(](.*)[)]/gm,fn:(t,e,n)=>{return t>=e&&t<=n}},EQUAL:{regex:/== [(](.*)[)]/gm,fn:(t,e)=>{return t==e}},NOTEQUAL:{regex:/!= [(](.*)[)]/gm,fn:(t,e)=>{return t!=e}},LESS:{regex:/< [(](.*)[)]/gm,fn:(t,e)=>{return t<e}},LESSEQ:{regex:/<= [(](.*)[)]/gm,fn:(t,e)=>{return t<=e}},GREATER:{regex:/> [(](.*)[)]/gm,fn:(t,e)=>{return t>e}},GREATEREQ:{regex:/> [(](.*)[)]/gm,fn:(t,e)=>{return t>=e}}}}function loadDashboard(){new FileHandler({callback:fillDashboard,fileInput:document.getElementById("load-file-input")}).setHandlers(),document.getElementById("load-file-input").click()}function saveDashboard(){dashb.download("dashboard")}function loadApp(){new FileHandler({callback:changeInputFile,dropArea:document.getElementById("drop-area"),fileInput:document.getElementById("file-input"),classHighlight:"highlight"}).setHandlers(),dashb.init(),renderDateFilter()}function renderDateFilter(){let t=document.getElementById("date-filter"),e=/BETWEENEQ [(](.*)[)]/gm;if(null!==(m=e.exec(dashb.msldb.widgetFilter.yearMonthDay))){let e=m[1].split(",");t.innerHTML=YMDToDate(e[0]).toLocaleDateString()+" - "+YMDToDate(e[1]).toLocaleDateString()}}function getDateFilter(){let t=/BETWEENEQ [(](.*)[)]/gm;if(null!==(m=t.exec(dashb.msldb.widgetFilter.yearMonthDay))){let t=m[1].split(",");return t[0]=t[0].substr(0,4)+"-"+t[0].substr(4,2)+"-"+t[0].substr(6,2),t[1]=t[1].substr(0,4)+"-"+t[1].substr(4,2)+"-"+t[1].substr(6,2),t}return[]}function updateDateFilter(t,e){dashb.msldb.widgetFilter.yearMonthDay=["BETWEENEQ ("+t.replace(/-/g,"")+","+e.replace(/-/g,"")+")"],renderDateFilter(),dashb.modal.close(),reRenderDashboard()}function initIndex(){let t=document.getElementById("menu-options-toggle");["click"].forEach(e=>{t.addEventListener(e,toggleMenuOptions,!1)})}function toggleMenuOptions(){let t=document.getElementById("menu-options");t.style.display=["","none",void 0].includes(t.style.display)?"block":"none",["click"].forEach(t=>{window.addEventListener(t,closeMenuOptions,!1)})}function closeMenuOptions(t){let e=document.getElementById("menu-options-toggle");if(t.target!=e){let t=document.getElementById("menu-options");return t.style.display="none",["click"].forEach(t=>{window.removeEventListener(t,closeMenuOptions,!1)}),!1}}String.prototype.dePersonalize=function(){var t=0;if(0==this.length)return t;for(var e=0;e<this.length;e++){t=(t<<5)-t+this.charCodeAt(e),t&=t}return Math.abs(t)},Date.prototype.diffTimestamp=function(t){let e=(this.getTime()/1e3-t)/60/60*3600,n=Math.floor(e/86400);e-=3600*n*24;let i=Math.floor(e/3600);e-=3600*i;let s=Math.floor(e/60);return e-=60*s,{days:n,hours:i,minutes:s,seconds:e}};var codeditor,dashb=new Dashboard({global:{css:"        .widget {resize:both;overflow:auto;margin:10px;padding:10px;background:white;border: 1px #d7dfe3 solid;border-radius:4px;-webkit-box-shadow: 0px 5px 20px rgba(0, 0, 0, 0.05);box-shadow: 0px 5px 20px rgba(0, 0, 0, 0.05);}        .widget .title {color:green;}        .widget .content {}        .widget .rows {font-size:30px;color:green;text-align:center}        .widget.section {background:#636363 !important;color:white !important}        .widget.section h2 {margin:2px}        .widget.section p {margin:2px}        .widget table {background:white}        .widget table > thead {background:gray;color:white}      "},widget:{html:'        <div onresize="console.log(\'t\');" class="widget" id="%ID%" style="width:%WIDTH%px;height:%HEIGHT%px">\n            <h2 id="title_%ID%" onclick="%CALLBACK%(\'%ID%\');" style="white-space:nowrap;overflow:hidden">%TITLE%</h2>\n            <div id="content_%ID%" class="content" style="width:100%;overflow:auto">\n              <div id="rows_%ID%" class="rows"></div>\n            </div>\n        </div>      '},db:{schema:schema,filters:filters,widgetFilter:{yearMonthDay:["BETWEENEQ ("+dateToYMD(365)+","+dateToYMD(0)+")"]}}});window[addEventListener?"addEventListener":"attachEvent"](addEventListener?"load":"onload",loadApp);class Flow{constructor(){}}window[addEventListener?"addEventListener":"attachEvent"](addEventListener?"load":"onload",initIndex);